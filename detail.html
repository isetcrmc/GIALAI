<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>D·ªØ li·ªáu chi ti·∫øt - Gi√°m s√°t ng·∫≠p T·ªânh Gia Lai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Calibri, sans-serif;
      font-size: 15px;
      color: #222;
    }
    .header-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #0074D9;
      color: white;
      font-size: 19px;
      display: flex;
      align-items: center;
      padding-left: 18px;
      z-index: 9999;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .nav-bar {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      height: 40px;
      background: #0074D9;
      color: white;
      display: flex;
      align-items: center;
      padding-left: 18px;
      font-size: 16px;
      z-index: 9999;
      gap: 20px;
    }
    .nav-bar a {
      color: white;
      text-decoration: none;
    }
    .nav-bar a.active {
      font-weight: bold;
    }
    .content {
      margin-top: 110px;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #999;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    .filter {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="header-bar">üì° H·ªá th·ªëng Gi√°m s√°t Ng·∫≠p l·ª•t T·ªânh Gia Lai</div>
  <div class="nav-bar">
    <a href="index.html">Trang ch·ªß</a>
    <a href="detail.html" class="active">D·ªØ li·ªáu chi ti·∫øt</a>
  </div>

  <div class="content">
    <h2>B·∫£ng d·ªØ li·ªáu v·∫øt l≈©</h2>
    <div class="filter">
      <label for="yearSelect">Ch·ªçn nƒÉm:</label>
      <select id="yearSelect">
        <option value="all">T·∫•t c·∫£</option>
  <option value="2020" selected>2020</option>
  <option value="2021">2021</option>
      </select>
      <span id="count" style="margin-left: 15px;"></span>
    </div>
    <div id="table">ƒêang t·∫£i d·ªØ li·ªáu...</div>
  </div>

<script>
  const container = document.getElementById("table");
  const yearSelect = document.getElementById("yearSelect");
  const countSpan = document.getElementById("count");
  let data = [];

  // T·∫£i GeoJSON
  fetch("Flood_trace_all.geojson")
    .then(res => res.json())
    .then(json => {
      data = json.features || [];
      renderTable(yearSelect.value);
    })
    .catch(() => { container.innerHTML = "L·ªói khi t·∫£i d·ªØ li·ªáu."; });

  yearSelect.addEventListener("change", () => renderTable(yearSelect.value));

  function renderTable(year) {
    // ·∫®n c√°c c·ªôt n√†y
    const exclude = new Set(["field_8","X_m","Y_m","VL2020","VL2021"]);

    // ƒê·ªïi t√™n hi·ªÉn th·ªã c·ªôt
    const headerAlias = {
      "Name": "T√™n v·∫øt l≈©",
      "H n·ªÅn": "Cao ƒë·ªô n·ªÅn (m)",
      "H_ngap": "Cao ƒë·ªô ng·∫≠p (m)",
      "Year": "NƒÉm",
      "Ward": "Ph∆∞·ªùng, x√£",
      "Address": "ƒê·ªãa ƒëi·ªÉm"
    };

    // C·ªôt ƒë·ªãnh d·∫°ng s·ªë (2 ch·ªØ s·ªë th·∫≠p ph√¢n)
    const coordCols = new Set(["X","Y","Lon","Lat","Longitude","Latitude"]);
    const numericCols = new Set(["H n·ªÅn","H_ngap"]); // th√™m c√°c c·ªôt s·ªë c·∫ßn l√†m tr√≤n

    const toNum = v => {
      if (v == null || v === "") return null;
      const n = Number(String(v).trim().replace(",", "."));
      return isFinite(n) ? n : null;
    };
    const fmt2 = v => {
      const n = toNum(v);
      return n == null ? (v ?? "") : n.toFixed(2);
    };

    // L·∫•y headers v√† lo·∫°i c·ªôt kh√¥ng hi·ªÉn th·ªã
    const rawHeaders = data.length > 0 ? Object.keys(data[0].properties) : [];
    const headers = rawHeaders.filter(h => !exclude.has(h));

    // L·ªçc theo nƒÉm: ch·ªâ gi·ªØ c√°c b·∫£n ghi c√≥ VL2020/VL2021 t∆∞∆°ng ·ª©ng
    const filtered = data.filter(f => {
      const v = f.properties?.[`VL${year}`];
      return v != null && String(v).includes(String(year));
    });

    if (countSpan) countSpan.textContent = `S·ªë v·∫øt l≈©: ${filtered.length}`;

    // Render b·∫£ng
    let html = `<table><thead><tr>${
      headers.map(h => `<th>${headerAlias[h] || h}</th>`).join("")
    }</tr></thead><tbody>`;

    filtered.forEach(f => {
      html += `<tr>` + headers.map(h => {
        const val = f.properties[h];
        // format 2 ch·ªØ s·ªë cho c·ªôt t·ªça ƒë·ªô & c·ªôt s·ªë ƒë√£ khai b√°o
        if (coordCols.has(h) || numericCols.has(h)) {
          return `<td>${fmt2(val)}</td>`;
        }
        return `<td>${val ?? ""}</td>`;
      }).join("") + `</tr>`;
    });

    html += `</tbody></table>`;
    container.innerHTML = html;
  }
</script>

</body>
</html>
